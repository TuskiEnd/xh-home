"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var version="2020-9-2-16-13";if(!hostConfig)var hostConfig={APIHost:"https://api.bimface.com",resourceHost:"https://m.bimface.com",staticHost:"https://static.bimface.com",dataEnvType:"BIMFACE"};void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),a=1;a<arguments.length;a++){var i=arguments[a];if(void 0!==i&&null!==i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t});var BimfaceConfigrationOption$1=Object.freeze({Release:"Release",Debug:"Debug"}),BimfaceViewTypeOption$1=Object.freeze({Normal:"Normal",DrawingView:"drawingView"}),BimfaceEnvOption=Object.freeze({BIMFACE:"BIMFACE",Local:"Local"}),BimfaceLanguageOption=Object.freeze({zh_CN:"zh_CN",en_GB:"en_GB",sv_SE:"sv_SE"}),BimfaceVisualStyle=Object.freeze({Normal:"Normal",Bake:"Bake"}),BimfaceSDKLoaderConfig=function(){return{staticHost:hostConfig.staticHost+"/api",APIHost:hostConfig.APIHost,language:"zh_CN",viewToken:null,configuration:BimfaceConfigrationOption$1.Release,dataEnvType:hostConfig.dataEnvType||"BIMFACE",viewType:BimfaceViewTypeOption$1.Normal,visualStyle:BimfaceVisualStyle.Bake,version:""}};window.BimfaceConfigrationOption=BimfaceConfigrationOption$1,window.BimfaceViewTypeOption=BimfaceViewTypeOption$1,window.BimfaceSDKLoaderConfig=BimfaceSDKLoaderConfig,window.BimfaceEnvOption=BimfaceEnvOption,window.BimfaceVisualStyle=BimfaceVisualStyle;var transfromPath=function(e){var t=e.split("/");return t.pop(),t.join("/")+"/"},getConfig=function(e){var t=Object.assign({},e),a="/Glodon";return e.path?(t.dataEnvType=BimfaceEnvOption.Local,t.url=t.path,t.staticHost=t.sdkPath||transfromPath(t.path),t.resourcePath=transfromPath(t.path),t.path=transfromPath(t.path),a=t.sdkPath?"":"/jssdk"):e.resourcePath?(t.dataEnvType=BimfaceEnvOption.Local,t.url=t.resourcePath,t.resourcePath=transfromPath(t.resourcePath)):t.url=e.APIHost+"/inside/databag?viewToken="+e.viewToken,t.staticHost+=a,e.build!=BimfaceConfigrationOption.Debug&&t.configuration!=BimfaceConfigrationOption.Release||(t.configuration=""),t.configuration=t.configuration?"-"+t.configuration.toLowerCase():"",t},transformFullUrl=function(e,t){for(var a=0;a<t.length;a++)t[a]=e+t[a]},isDrawingView=function(e,t){return"drawingView"==e.renderType||t.viewType==BimfaceViewTypeOption.DrawingView},getLoadModules=function(e){var t=e.sdkVersion,a=e.options,i=a.configuration,n=[],o=["/"+t+"/"+a.language+".js","/"+t+"/Application"+i+".js"];return n=isDrawingView(e.metadata,e.options)?[].concat(_toConsumableArray(n),o,["/"+t+"/Drawing.css","/"+t+"/bimface.bufferfly.js","/"+t+"/Drawing"+i+".js"]):[].concat(_toConsumableArray(n),o,["/"+t+"/Bimface.css","/"+t+"/thirdparty.js","/"+t+"/BimTilesLoader.js","/"+t+"/Bimface"+i+".js"])};window.postProcessing=function(e){var t=e.metadata,a=e.options,i=e.successCb,n=getLoadModules(e);transformFullUrl(a.staticHost,n),t.databagId=""+t.databagId,a.path?(t.path=a.path,t.dataPath="./"):a.resourcePath&&(t.path=a.resourcePath.replace("viewToken","")),t.sdkPath=a.sdkPath,0==n.length?i(t):loadResource(n,function(){if(a.build===BimfaceConfigrationOption.Debug&&a.dataPath){var e=a.dataPath.split("/");i({databagId:e.pop(),path:e.join("/")})}i(t)})};var loadResource=function e(t,a,i){var n=t.length,o=0,r=function r(s){if(s&&"error"==s.message&&s.element.indexOf("bimface.index")>-1){o=0;var c=i.options;c.build,BimfaceConfigrationOption.Release;var f=getLoadModules(i);return transformFullUrl(c.staticHost,f),void e(f,a)}o++,o==n?a():createResource(t[o],r)};createResource(t[o],r)},loaded=[],createResource=function(e,t){if(loaded.indexOf(e.split("/").pop())>-1)return void t();var a,i=document.getElementsByTagName("head")[0];return e.indexOf(".css")>-1?(a=document.createElement("link"),a.setAttribute("href",e),a.setAttribute("rel","stylesheet")):(a=document.createElement("script"),a.setAttribute("src",e)),a.url=e,i.appendChild(a),a.addEventListener("load",function(){loaded.push(this.url.split("/").pop()),t&&t({message:"success"})}),a.addEventListener("error",function(){t&&t({element:e,message:"error"})}),a},ajax=function(e){var t,a={type:"get",data:null,success:null,failure:null},i=Object.assign(a,e);t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState){var e=t.status;e>=200&&e<300||0==e?i.success&&i.success(t.responseText,t.responseXML):i.failure&&i.failure(e)}},t.open(i.type,i.url,i.async),t.send(i.data)},getMetadata=function(e,t,a){ajax({url:e,success:function(e){var t=JSON.parse(e);t=t.data||t,a&&a(t)},failure:function(e){t&&t(e)}})},getVersion=function(e,t){var a=t.version,i=void 0;e.renderVersion;if(/\d+?\.\d+?\.\d+/.test(a)&&a.split(".")[0]>=3)a="Bimface@"+a;else if("Debug"==t.build)a="Bimface",i="Application";else if(t.viewType==BimfaceViewTypeOption.DrawingView&&"drawingView"!=e.renderType){var n=e.subRenders;if(n&&0!=n.length)for(var o=0;o<n.length;o++)n[o].renderType==BimfaceViewTypeOption.DrawingView&&(a=n[o].jsSDKVersion,i=n[o].jsSDKVersion)}else a=e.jsSDKVersion,i=e.jsSDKVersion;return{ui:i,sdk:a}},loaderPreProcessing=function(e,t,a){getMetadata(e.url,a,function(a){var i=getVersion(a,e);window.bimfaceStaticHost="Local"==BimfaceLoaderConfig.dataEnvType?e.staticHost+"/bimface":e.staticHost+"/"+i.sdk;var n={metadata:a,options:e,successCb:t,sdkVersion:i.sdk,uiVersion:i.ui},o=bimfaceStaticHost+"/bimface.index.js";loadResource([o],function(){postProcessing(n)},n)})},formatData=function(e,t){var a="bimView"==e.renderType?"3DView":e.renderType,i=(e.subRenders,{dataEnvType:t.dataEnvType,viewToken:t.viewToken,staticHost:t.staticHost,APIHost:t.APIHost,viewType:a});return Object.assign(i,e)},BimfaceSDKLoader={Version:version,load:function(e,t,a){window.BimfaceLoaderConfig=e,void 0==e.build&&(e.build=BimfaceConfigrationOption.Release);var i=getConfig(e);loaderPreProcessing(i,function(a)
